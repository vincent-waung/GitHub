@{
    ViewBag.Title = "DashboardIndex";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
}
@section scripts{
    <script src="~/Scripts/processingajaxmsg.js"></script>
    <script src="~/Scripts/xzUtil.js"></script>
<script src="~/Highcharts-8.2.0/code/highcharts.js"></script>
}

<!DOCTYPE html>

<html>
<head>

    <meta name="viewport" content="width=device-width" />
    <title>Dashboard</title>
</head>
<body class="easyui-layout" data-options="fit:true">
    
   

    <!--订单信息-->
    <div data-options="region:'center',border:false" style="height: 400px; overflow-y:scroll">
        <table>
            

            <tr style="display:inline-block">
                <td id="t" width="4000px" height="900px" colspan="2">
                    <div class="easyui-accordion"  data-options="multiple:true,selected:false" style="width:100%">
                        <div title="Summary" style="overflow:auto;padding:10px;">
                            <table>
                                <tr style="display:inline-block">
                                    <td width="4000px" height="300px">
                                        <table id="dgBooking"></table>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div title="Dashboard" style="padding:10px;">
                            <table>
                                <tr style="display:inline-block">
                                    <td width="1500px" height="400px">
                                        <div id="container3" style="min-width:400px;height:400px"></div>
                                    </td>
                                    <td width="1500px" height="400px">
                                        <div id="container4" style="min-width:400px;height:400px"></div>
                                    </td>
                                </tr>
                                <tr style=" display:inline-block">
                                    <td width="1500px" height="400px">
                                        <div id="container" style="min-width:400px;height:400px;"></div>
                                    </td>
                                    <td width="1500px" height="400px">
                                        <div id="container2" style="min-width:400px;height:400px"></div>
                                    </td>
                                </tr>

                            </table>
                        </div>
                        <div title="Detail">
                            <table>
                                <tr class="Abnormal" style="display:inline">
                                    <td width="4000px" height="300px" colspan="2">
                                        <table id="dgBooking2"></table>
                                    </td>
                                </tr>
                                <tr class="Abnormal" style="display:inline">
                                    <td width="4000px" height="300px" colspan="2">
                                        <table id="dgBooking3"></table>
                                    </td>
                                </tr>
                                <tr class="Abnormal" style="display:inline">
                                    <td width="4000px" height="300px" colspan="2">
                                        <table id="dgBooking4"></table>
                                    </td>
                                </tr>
                                @*<tr class="Abnormal" style="display:inline">
                                    <td width="4000px" height="300px" colspan="2">
                                        <table id="dgBooking5"></table>
                                    </td>
                                </tr>*@
                                
                                <tr class="Shipped" style="display:inline">
                                    <td width="4000px" height="300px" colspan="2">
                                        <table id="dgBooking7"></table>
                                    </td>
                                </tr>
                                <tr class="Ontrack" style="display:inline">
                                    <td width="4000px" height="300px" colspan="2">
                                        <table id="dgBooking8"></table>
                                    </td>
                                </tr>
                                <tr class="Sep" style="display:inline">
                                    <td width="4000px" height="300px" colspan="2">
                                        <table id="dgBooking6"></table>
                                    </td>
                                </tr>
                                <tr class="Sep" style="display:inline">
                                    <td width="4000px" height="300px" colspan="2">
                                        <table id="dgBooking9"></table>
                                    </td>
                                </tr>
                                <tr class="Sep" style="display:inline">
                                    <td width="4000px" height="300px" colspan="2">
                                        <table id="dgBooking10"></table>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </td>
            </tr>

        </table>
    </div>
    <div></div>

    

    @*<div></div>
    <div data-options="region:'north',title:'Filter Conditions',split:true,border:false,collapsed:false" style="height:800px;overflow:hidden;">
        <div id="condition" class="container_12" style="position:relative; border:0px solid #880000">
            <table>

                <tr style="display:inline-block">
                    <td width="1500px" height="400px">
                        <div id="container" style="min-width:400px;height:400px"></div>
                    </td>
                    <td width="1500px" height="400px">
                        <div id="container2" style="min-width:400px;height:400px"></div>
                    </td>
                </tr>

                <tr style="display:inline-block">
                    <td width="1500px" height="400px">
                        <div id="container3" style="min-width:400px;height:400px"></div>
                    </td>
                    <td width="1500px" height="400px">
                        <div id="container4" style="min-width:400px;height:400px"></div>
                    </td>
                </tr>
            </table>

        </div>
    </div>*@

    <script type="text/javascript">
        var dgBooking;
        var searchForm;
        var Abnormaldata;
        var Shippeddata;
        var Ontrackdata;
        var Octdata;
        var Sepdata; 
     
        function show(name, val) {
            if (name == "Exception") {
                if (Abnormaldata != undefined) {

                    $(".Abnormal").show();
                    $(".Sep").hide();
                    //$(".Oct").hide();
                    $(".Shipped").hide();
                    $(".Ontrack").hide();
                } else {

                    $.post("/OnlineBooking_Areas/LoadPlanQuery/getPolistReport", { key: "Abnormal" }, function (jsonObj, textStatus) {

                        Abnormaldata = jsonObj;
                        $(".Abnormal").show();
                        $(".Sep").hide();
                        $(".Oct").hide();
                        $(".Shipped").hide();
                        $(".Ontrack").hide();
                        $("#dgBooking2").datagrid({
                            fit: true,
                            fitColumns: false,
                            autoRowHeight: false,
                            rownumbers: true,
                            nowrap: true, //如果为true，则在同一行中显示数据。设置为true可以提高加载性能。
                            animate: false,
                            sortable: true,
                            border: false,
                            singleSelect: true,
                            title: "NO Booking date",
                            loadMsg: 'Loading……',
                            // idField: 'rId',
                            //把表单元素序列化成对象

                            data: jsonObj[0].NobookingAbnormalloadplanList,
                            columns: [[

                                { field: 'Vendor_Name', title: 'Vendor Name', width: 300 },
                                { field: 'Mfr_Name1', title: 'Mfr_Name1', width: 150 },
                                { field: 'FOB_Customer_Name', title: 'Customer Name', width: 150 },
                                { field: 'Purch_Doc', title: 'Purch.Doc', width: 150 },
                                { field: 'Item', title: 'Item', width: 150 },
                                {
                                    field: 'FOB_First_Date', title: 'First Date', width: 150, formatter: function (value) {
                                        if (value) {
                                            return value.substr(0, 10);
                                        }
                                    }
                                },
                                {
                                    field: 'PO_quantity', title: 'PO_quantity', width: 150
                                },
                                {
                                    field: 'Total_Carton', title: 'Total_Carton', width: 150
                                },
                                {
                                    field: 'Total_Volume', title: 'Total_Volume', width: 150
                                },

                            ]]
                        });
                        $("#dgBooking3").datagrid({
                            fit: true,
                            fitColumns: false,
                            autoRowHeight: false,
                            rownumbers: true,
                            nowrap: true, //如果为true，则在同一行中显示数据。设置为true可以提高加载性能。
                            animate: false,
                            border: false,
                            sortable: true,
                            singleSelect: true,
                            title: "NO SO release date",
                            loadMsg: 'Loading……',
                            // idField: 'rId',
                            //把表单元素序列化成对象
                            data: jsonObj[0].NoSoDateAbnormalloadplanList,
                            columns: [[

                                { field: 'Vendor_Name', title: 'Vendor Name', width: 300 },
                                { field: 'Mfr_Name1', title: 'Mfr_Name1', width: 150 },
                                { field: 'FOB_Customer_Name', title: 'Customer Name', width: 150 },
                                { field: 'Purch_Doc', title: 'Purch.Doc', width: 150 },
                                { field: 'Item', title: 'Item', width: 150 },
                                {
                                    field: 'Booking_Date', title: 'Booking Date', width: 150, formatter: function (value) {
                                        if (value) {
                                            return value.substr(0, 10);
                                        }
                                    }
                                },
                                {
                                    field: 'PO_quantity', title: 'PO_quantity', width: 150
                                },
                                {
                                    field: 'Total_Carton', title: 'Total_Carton', width: 150
                                },
                                {
                                    field: 'Total_Volume', title: 'Total_Volume', width: 150
                                },

                            ]]
                        });
                        $("#dgBooking4").datagrid({
                            fit: true,
                            fitColumns: false,
                            autoRowHeight: false,
                            rownumbers: true,
                            nowrap: true, //如果为true，则在同一行中显示数据。设置为true可以提高加载性能。
                            animate: false,
                            border: false,
                            sortable: true,
                            singleSelect: true,
                            title: "PO quantity / carton / CBM variance",
                            loadMsg: 'Loading……',
                            // idField: 'rId',
                            //把表单元素序列化成对象
                            data: jsonObj[0].VarianceAbnormalloadplanList,
                            columns: [[
                                { field: 'Vendor_Name', title: 'Vendor Name', width: 300 },
                                { field: 'Mfr_Name1', title: 'Mfr_Name1', width: 150 },
                                { field: 'FOB_Customer_Name', title: 'Customer Name', width: 150 },
                                { field: 'Purch_Doc', title: 'Purch.Doc', width: 150 },
                                { field: 'Item', title: 'Item', width: 150 },
                                {
                                    field: 'FOB_First_Date', title: 'First Date', width: 150, formatter: function (value) {
                                        if (value) {
                                            return value.substr(0, 10);
                                        }
                                    }
                                }, {
                                    field: 'Quantiryvariance', title: 'Quantiryvariance', width: 150
                                }, {
                                    field: 'Cartonvariance', title: 'Cartonvariance', width: 150
                                }, {
                                    field: 'Cbmvariance', title: 'Cbmvariance', width: 150
                                },
                                //{
                                //    field: 'PO_quantity', title: 'PO_quantity', width: 150
                                //},
                                //{
                                //    field: 'Total_Carton', title: 'Total_Carton', width: 150
                                //},
                                //{
                                //    field: 'Total_Volume', title: 'Total_Volume', width: 150
                                //},

                            ]]
                        });
                        //$("#dgBooking5").datagrid({
                        //    fit: true,
                        //    fitColumns: false,
                        //    rownumbers: true,
                        //    nowrap: true, //如果为true，则在同一行中显示数据。设置为true可以提高加载性能。
                        //    animate: false,
                        //    border: false,
                        //    singleSelect: true,
                        //    title: "NO actual arrive date in whs / terminal",
                        //    loadMsg: 'Loading……',
                        //    // idField: 'rId',
                        //    //把表单元素序列化成对象
                        //    data: jsonObj[0].NOActualAbnormalloadplanList,
                        //    columns: [[
                        //        { field: 'Vendor_Name', title: 'Vendor Name', width: 300 },
                        //        { field: 'Mfr_Name1', title: 'Mfr_Name1', width: 150 },
                        //        { field: 'FOB_Customer_Name', title: 'Customer Name', width: 150 },
                        //        { field: 'Purch_Doc', title: 'Purch.Doc', width: 150 },
                        //        { field: 'Item', title: 'Item', width: 150 },
                        //        {
                        //            field: 'CY_Closing_Date', title: 'CFS/CY Closing date', width: 150
                        //        },

                        //    ]]
                        //});
                        //$("#dgBooking6").datagrid({
                        //    fit: true,
                        //    fitColumns: false,
                        //    rownumbers: true,
                        //    nowrap: true, //如果为true，则在同一行中显示数据。设置为true可以提高加载性能。
                        //    animate: false,
                        //    border: false,
                        //    singleSelect: true,
                        //    title: "NO Certificate return to SM Date or FCR/Bill of Loading return to SM Date ",
                        //    loadMsg: 'Loading……',
                        //    // idField: 'rId',
                        //    //把表单元素序列化成对象
                        //    data: jsonObj[0].NOCertificateAbnormalloadplanList,
                        //    columns: [[
                        //        { field: 'Vendor_Name', title: 'Vendor Name', width: 300 },
                        //        { field: 'Mfr_Name1', title: 'Mfr_Name1', width: 150 },
                        //        { field: 'FOB_Customer_Name', title: 'Customer Name', width: 150 },
                        //        { field: 'Purch_Doc', title: 'Purch.Doc', width: 150 },
                        //        { field: 'Item', title: 'Item', width: 150 },
                        //        {
                        //            field: 'ETD', title: 'ETD', width: 150
                        //        },

                        //    ]]
                        //});
                    }, "json");
                }
            }
            else if (name == "Shipped") {
                if (Shippeddata != undefined) {

                    $(".Shipped").show();
                    $(".Sep").hide();
                    //$(".Oct").hide();
                    $(".Abnormal").hide();
                    $(".Ontrack").hide();
                } else {


                    $.post("/OnlineBooking_Areas/LoadPlanQuery/getPolistReport", { key: "Shipped" }, function (jsonObj, textStatus) {

                        Shippeddata = jsonObj;
                        $(".Shipped").show();
                        $(".Sep").hide();
                        $(".Oct").hide();
                        $(".Abnormal").hide();
                        $(".Ontrack").hide();
                        $("#dgBooking7").datagrid({
                            fit: true,
                            fitColumns: false,
                            rownumbers: true,
                            autoRowHeight: false,
                            nowrap: true, //如果为true，则在同一行中显示数据。设置为true可以提高加载性能。
                            animate: false,
                            sortable: true,
                            border: false,
                            singleSelect: true,
                            title: "Shipped",
                            loadMsg: 'Loading……',
                            // idField: 'rId',
                            //把表单元素序列化成对象
                            data: jsonObj[1].ShippedloadplanList,
                            columns: [[

                                { field: 'Mfr_Name1', title: 'Mfr Name', width: 150 },
                                { field: 'FOB_Customer_Name', title: 'Customer Name', width: 150 },
                                { field: 'SalesOrd_STO', title: 'SalesOrd_STO', width: 150 },
                                { field: 'ItemNO', title: 'ItemNo', width: 150 },
                                { field: 'Purch_Doc', title: 'Purch.Doc', width: 150 },
                                { field: 'Item', title: 'Item', width: 150 },
                                {
                                    field: 'FOB_First_Date', title: 'FOB_First_Date', width: 150, formatter: function (value) {
                                        if (value) {
                                            return value.substr(0, 10);
                                        }
                                    }
                                },
                                {
                                    field: 'FOB_Cancel_Date', title: 'FOB_Cancel_Date', width: 150, formatter: function (value) {
                                        if (value) {
                                            return value.substr(0, 10);
                                        }
                                    }
                                },
                                {
                                    field: 'Qty_Delivered', title: 'Qty_Delivered', width: 150
                                },
                                {
                                    field: 'Carton_delivered', title: 'Carton_delivered', width: 150
                                },
                                {
                                    field: 'Delivery_CBM', title: 'Delivery_CBM', width: 150
                                },

                            ]]
                        });
                    }, "json");
                }
            } else if (name == "Open Order") {
                if (Ontrackdata != undefined) {
                    $(".Ontrack").show();
                    $(".Sep").hide();
                    //$(".Oct").hide();
                    $(".Abnormal").hide();
                    $(".Shipped").hide();

                } else {

                    $.post("/OnlineBooking_Areas/LoadPlanQuery/getPolistReport", { key: "On track" }, function (jsonObj, textStatus) {

                        Ontrackdata = jsonObj;
                        $(".Ontrack").show();
                        $(".Sep").hide();
                        $(".Oct").hide();
                        $(".Abnormal").hide();
                        $(".Shipped").hide();
                        $("#dgBooking8").datagrid({
                            fit: true,
                            fitColumns: false,
                            autoRowHeight: false,
                            rownumbers: true,
                            nowrap: true, //如果为true，则在同一行中显示数据。设置为true可以提高加载性能。
                            animate: false,
                            sortable: true,
                            border: false,
                            singleSelect: true,
                            title: "Open Order",
                            loadMsg: 'Loading……',
                            // idField: 'rId',
                            //把表单元素序列化成对象
                            data: jsonObj[2].OntrackloadplanList,
                            columns: [[

                                { field: 'Mfr_Name1', title: 'Mfr Name', width: 150 },
                                { field: 'FOB_Customer_Name', title: 'Customer Name', width: 150 },
                                { field: 'SalesOrd_STO', title: 'SalesOrd_STO', width: 150 },
                                { field: 'ItemNO', title: 'ItemNo', width: 150 },
                                { field: 'Purch_Doc', title: 'Purch.Doc', width: 150 },
                                { field: 'Item', title: 'Item', width: 150 },
                                {
                                    field: 'FOB_First_Date', title: 'FOB_First_Date', width: 150, formatter: function (value) {
                                        if (value) {
                                            return value.substr(0, 10);
                                        }
                                    }
                                },
                                {
                                    field: 'FOB_Cancel_Date', title: 'FOB_Cancel_Date', width: 150, formatter: function (value) {
                                        if (value) {
                                            return value.substr(0, 10);
                                        }
                                    }
                                },
                                {
                                    field: 'PO_quantity', title: 'PO_quantity', width: 150
                                },
                                {
                                    field: 'Total_Carton', title: 'Total_Carton', width: 150
                                },
                                {
                                    field: 'Total_Volume', title: 'Total_Volume', width: 150
                                },


                            ]]
                        });
                    }, "json");
                }
            }
            else if (name == "Total") {
                if (Sepdata != undefined) {

                    $(".Sep").show();
                    //$(".Oct").hide();
                    $(".Ontrack").hide();
                    $(".Abnormal").hide();
                    $(".Shipped").hide();
                } else {
                    $.post("/OnlineBooking_Areas/LoadPlanQuery/getPolistReport", { key: "Total" }, function (jsonObj, textStatus) {

                        Sepdata = jsonObj;
                        $(".Sep").show();
                        //$(".Oct").hide();
                        $(".Ontrack").hide();
                        $(".Abnormal").hide();
                        $(".Shipped").hide();
                        $("#dgBooking9").datagrid({
                            fit: true,
                            fitColumns: false,
                            rownumbers: true,
                            autoRowHeight: false,
                            nowrap: true, //如果为true，则在同一行中显示数据。设置为true可以提高加载性能。
                            animate: false,
                            sortable: true,
                            border: false,
                            title: "Sep",
                            singleSelect: true,
                            loadMsg: 'Loading……',
                            // idField: 'rId',
                            //把表单元素序列化成对象
                            data: jsonObj[3].OverallloadplanList,
                            columns: [[
                                { field: 'Mfr_Name1', title: 'Mfr_Name1', width: 150 },
                                { field: 'FOB_Customer_Name', title: 'Customer Name', width: 150 },
                                { field: 'TotalNoofPOitem', title: 'Total No of PO item', width: 150 },
                                { field: 'TotalQty', title: 'Total Qty', width: 150 },
                                { field: 'Total_CBM', title: 'Total CBM', width: 150 },
                                { field: 'ConfirmedPO', title: 'No.of Confirmed  PO item', width: 150 },
                                { field: 'ConfirmedQty', title: 'Confirmed CBM', width: 150 },
                                { field: 'ConfirmedCBM', title: 'Confirmed CBM', width: 150 },
                                { field: 'Completed', title: 'Completed %', width: 150 },
                                { field: 'NoConfirmeItem', title: 'No Confirme Item', width: 150 },
                                { field: 'NoConfirmedQty', title: 'No Confirmed Qty', width: 150 },
                                { field: 'NoConfirmedCBM', title: 'No Confirmed CBM', width: 150 },

                            ]]
                        }); 

                        $("#dgBooking6").datagrid({
                            fit: true,
                            fitColumns: false,
                            autoRowHeight: false,
                            rownumbers: true,
                            nowrap: true, //如果为true，则在同一行中显示数据。设置为true可以提高加载性能。
                            animate: false,
                            border: false,
                            sortable: true,
                            title: "Aug",
                            singleSelect: true,
                            loadMsg: 'Loading……',
                            // idField: 'rId',
                            //把表单元素序列化成对象
                            data: jsonObj[3].uploadplanList,
                            columns: [[
                                { field: 'Mfr_Name1', title: 'Mfr_Name1', width: 150 },
                                { field: 'FOB_Customer_Name', title: 'Customer Name', width: 150 },
                                { field: 'TotalNoofPOitem', title: 'Total No of PO item', width: 150 },
                                { field: 'TotalQty', title: 'Total Qty', width: 150 },
                                { field: 'Total_CBM', title: 'Total CBM', width: 150 },
                                { field: 'ConfirmedPO', title: 'No.of Confirmed  PO item', width: 150 },
                                { field: 'ConfirmedQty', title: 'Confirmed CBM', width: 150 },
                                { field: 'ConfirmedCBM', title: 'Confirmed CBM', width: 150 },
                                { field: 'Completed', title: 'Completed %', width: 150 },
                                { field: 'NoConfirmeItem', title: 'No Confirme Item', width: 150 },
                                { field: 'NoConfirmedQty', title: 'No Confirmed Qty', width: 150 },
                                { field: 'NoConfirmedCBM', title: 'No Confirmed CBM', width: 150 },

                            ]]
                        });


                        $("#dgBooking10").datagrid({
                            fit: true,
                            fitColumns: false,
                            autoRowHeight: false,
                            rownumbers: true,
                            nowrap: true, //如果为true，则在同一行中显示数据。设置为true可以提高加载性能。
                            animate: false,
                            border: false,
                            sortable: true,
                            title: "Oct",
                            singleSelect: true,
                            loadMsg: 'Loading……',
                            // idField: 'rId',
                            //把表单元素序列化成对象
                            data: jsonObj[3].NextloadplanList,
                            columns: [[
                                { field: 'Mfr_Name1', title: 'Mfr_Name1', width: 150 },
                                { field: 'FOB_Customer_Name', title: 'Customer Name', width: 150 },
                                { field: 'TotalNoofPOitem', title: 'Total No of PO item', width: 150 },
                                { field: 'TotalQty', title: 'Total Qty', width: 150 },
                                { field: 'Total_CBM', title: 'Total CBM', width: 150 },
                                { field: 'ConfirmedPO', title: 'No.of Confirmed  PO item', width: 150 },
                                { field: 'ConfirmedQty', title: 'Confirmed CBM', width: 150 },
                                { field: 'ConfirmedCBM', title: 'Confirmed CBM', width: 150 },
                                { field: 'Completed', title: 'Completed %', width: 150 },
                                { field: 'NoConfirmeItem', title: 'No Confirme Item', width: 150 },
                                { field: 'NoConfirmedQty', title: 'No Confirmed Qty', width: 150 },
                                { field: 'NoConfirmedCBM', title: 'No Confirmed CBM', width: 150 },

                            ]]
                        });
                    }, "json");


                }
            }
            else if (name == "Oct") {
                if (Octdata != undefined) {

                    //$(".Oct").show();
                    $(".Sep").hide();
                    $(".Ontrack").hide();
                    $(".Abnormal").hide();
                    $(".Shipped").hide();
                } else {


                 
                }

            }

        }
        


        $(function () {
            $(".easyui-accordion .panel-header").click();
            var start_time = new Date();
            var end_time = new Date();
            start_time.setDate(start_time.getDate() - 7);
            $("#jrstartdate").datebox("setValue", myformatter(start_time));

            $("#jrenddate").datebox("setValue", myformatter(end_time));
            loadCustomer();
            //获取时间
            //var beginTime=$("#txtBeginTime").datebox("getValue");
            //var endTime=$("#txtEndTime").datebox("getValue");

            // alert(nowdate.toDateString());
            //  alert(nodate.getFullYear());
            //alert(nodate.getMonth());
            //alert(nowdate.getDate());
            //$('#startdate').datebox('setValue', nowdate.getMonth() + 1 + '-' + nowdate.getDate() + '-' + nowdate.getFullYear());
            // nowdate.setDate(nowdate.getDate() + 15);

            // $('#enddate').datebox('setValue', nowdate.getMonth() + 1 + '-' + nowdate.getDate() + '-' + nowdate.getFullYear());
            searchForm = $('#searchForm');
            dgBooking = $("#dgBooking").datagrid({
                iconCls: 'icon-save',
                fit: true,
                fitColumns: false,
                rownumbers: true,
                nowrap: true, //如果为true，则在同一行中显示数据。设置为true可以提高加载性能。
                animate: false,
                border: false,
                singleSelect: true,
                sortable :true,
                loadMsg: 'Loading……',
                // idField: 'rId',
                //把表单元素序列化成对象
                queryParams: { key: "" },
                url: '/OnlineBooking_Areas/LoadPlanQuery/getPolistReport',
                toolbar: [{
                    text: 'Refresh',
                    iconCls: 'icon-reload',
                    handler: function () {
                        dgBooking.datagrid('load');

                    }
                }
                 //,
                 //  '-', {
                 //      text: '完成卸货',
                 //      iconCls: 'icon-ok',
                 //      handler: function () {
                 //          completUnloading();    
                 //      }
                 //  },
                 //    '-', {
                 //        text: '已卸清单',
                 //        iconCls: 'icon-remove',
                 //        handler: function () {
                 //            showUnloadingDetailView();
                 //        }
                 //    }

                ],
                columns: [[
                    { field: 'Management', title: 'Management', width: 300, align: 'center' },
                    { field: 'SepItem', title: 'NO.of Purch.Doc/Item (Oct)', width: 200, align: 'center' },
                    { field: 'OctItem', title: 'NO.of Purch.Doc/Item (Nov)', width: 200, align: 'center' },
                    { field: 'NovItem', title: 'NO.of Purch.Doc/Item (Dec)', width: 200, align: 'center' },
                    { field: 'PoItem', title: 'Total', width: 150, align: 'center' },
                    {
                        field: 'percentage', title: '%', width: 100, align: 'center'
                    },
                    {
                        field: 'CBM', title: 'CBM', width: 200, formatter: function (value) {
                            var f_x = parseFloat(value);
                            //if (isNaN(f_x)) {
                            //    alert('function:changeTwoDecimal->parameter error');
                            //    return false;
                            //}
                            var f_x = Math.round(value * 100) / 100;
                            var s_x = f_x.toString();
                            var pos_decimal = s_x.indexOf('.');
                            if (pos_decimal < 0) {
                                pos_decimal = s_x.length;
                                s_x += '.';
                            }
                            while (s_x.length <= pos_decimal + 2) {
                                s_x += '0';
                            }
                            return s_x;

                        }, align: 'center'
                    },
                    //{
                    //    field: 'CBMpercentage', title: 'CBM%', width: 180
                    //},
                    {
                        field: 'opt', title: 'Detail', width: 50, align: 'center',
                        formatter: function (value, rec) {
                            var btn = '<a class="editcls" onclick="show(\'' + rec.Management + '\',\'' + rec.POpercentage + '\')" href="javascript:void(0)">Detail</a>';
                            return btn;
                        }
                    }
                ]],



                onRowContextMenu: function (e, rowIndex, rowData) {
                    //e.preventDefault();
                    //$(this).datagrid('unselectAll');
                    //$(this).datagrid('selectRow', rowIndex);
                    //$('#menu').menu('show', {
                    //    left: e.pageX,
                    //    top: e.pageY
                    //});
                },

                onLoadSuccess: function (data) {
                    var rows = $("#dgBooking").datagrid('getRows').length;
                    var chart = Highcharts.chart('container', {
                        chart: {
                            plotBackgroundColor: null,
                            plotBorderWidth: null,
                            plotShadow: false,
                            type: 'pie'
                        },
                        title: {
                            text: 'Oct - Dec  Overall - Total No.of Purch.doc/Item'
                        },
                        tooltip: {
                            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                        },
                        plotOptions: {
                            pie: {
                                allowPointSelect: true,
                                cursor: 'pointer',
                                dataLabels: {
                                    enabled: false
                                },
                                showInLegend: true
                            }
                        },
                        series: [{
                            name: '',

                            colors: ['#46A3FF', '#484891', '#2828FF'],
                            colorByPoint: true,
                            data: [{
                                name: 'Oct',
                                y: (parseInt(data.rows[0].SepItem) + parseInt(data.rows[1].SepItem) + parseInt(data.rows[2].SepItem)) / (parseInt(data.rows[3].SepItem) + parseInt(data.rows[3].OctItem) + parseInt(data.rows[3].NovItem))*100,
                                sliced: true,
                                selected: true
                            }, {
                                name: 'Nov',
                                y: (parseInt(data.rows[0].OctItem) + parseInt(data.rows[1].OctItem) + parseInt(data.rows[2].OctItem)) / (parseInt(data.rows[3].SepItem) + parseInt(data.rows[3].OctItem) + parseInt(data.rows[3].NovItem)) * 100,
                            }, {
                                name: 'Dec',
                                y: (parseInt(data.rows[0].NovItem) + parseInt(data.rows[1].NovItem) + parseInt(data.rows[2].NovItem)) / (parseInt(data.rows[3].SepItem) + parseInt(data.rows[3].OctItem) + parseInt(data.rows[3].NovItem)) * 100,
                            }]
                        }]
                    });
                    var chart = Highcharts.chart('container2', {
                        chart: {
                            plotBackgroundColor: null,
                            plotBorderWidth: null,
                            plotShadow: false,
                            type: 'pie'
                        },
                        title: {
                            text: 'Oct - Dec  Overall - Total CBM'
                        },
                        tooltip: {
                            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                        },
                        plotOptions: {
                            pie: {
                                allowPointSelect: true,
                                cursor: 'pointer',
                                dataLabels: {
                                    enabled: false
                                },
                                showInLegend: true
                            }
                        },
                        series: [{
                            name: '',
                            colors: ['#46A3FF', '#484891', '#2828FF'],
                            colorByPoint: true,
                            data: [{name: 'Brands',
                                name: 'Oct',
                                y: (parseInt(data.rows[0].SepCBM) + parseInt(data.rows[1].SepCBM) + parseInt(data.rows[2].SepCBM)) / (parseInt(data.rows[3].SepCBM) + parseInt(data.rows[3].OctCBM) + parseInt(data.rows[3].NovCBM)) * 100,
                                sliced: true,
                                selected: true
                            }, {
                                name: 'Nov',
                                y: (parseInt(data.rows[0].OctCBM) + parseInt(data.rows[1].OctCBM) + parseInt(data.rows[2].OctCBM)) / (parseInt(data.rows[3].SepCBM) + parseInt(data.rows[3].OctCBM) + parseInt(data.rows[3].NovCBM)) * 100,
                            }, {
                                name: 'Dec',
                                y: (parseInt(data.rows[0].NovCBM) + parseInt(data.rows[1].NovCBM) + parseInt(data.rows[2].NovCBM)) / (parseInt(data.rows[3].SepCBM) + parseInt(data.rows[3].OctCBM) + parseInt(data.rows[3].NovCBM)) * 100,
                            }]
                        }]
                    });

                    // Build the chart
                    Highcharts.chart('container3', {
                        chart: {
                            plotBackgroundColor: null,
                            plotBorderWidth: null,
                            plotShadow: false,
                            type: 'pie'
                        },
                        title: {
                            text: 'Nov Overall status - Total No.of Purch.doc/Item'
                        },
                        tooltip: {
                            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                        },
                        plotOptions: {
                            pie: {
                                allowPointSelect: true,
                                cursor: 'pointer',
                                dataLabels: {
                                    enabled: false
                                },
                                showInLegend: true
                            }
                        },
                        series: [{
                            name: '',
                            colors: ['#FF0000', '#00BB00', '#FFFF37'],
                            colorByPoint: true,
                            data: [{
                                name: 'Exception',
                                y: parseInt(data.rows[0].POpercentage),
                                sliced: true,
                                selected: true
                            }, {
                                name: 'Shipped',
                                y: parseInt(data.rows[1].POpercentage)
                            }, {
                                name: 'Open Order',
                                y: parseInt(data.rows[2].POpercentage)
                            }]
                        }]
                    });
                    Highcharts.chart('container4', {
                        chart: {
                            plotBackgroundColor: null,
                            plotBorderWidth: null,
                            plotShadow: false,
                            type: 'pie'
                        },
                        title: {
                            text: 'Nov Overall status - Total CBM'
                        },
                        tooltip: {
                            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                        },
                        plotOptions: {
                            pie: {
                                allowPointSelect: true,
                                cursor: 'pointer',
                                dataLabels: {
                                    enabled: false
                                },
                                showInLegend: true
                            }
                        },
                        series: [{
                            name: '',
                            colors: ['#FF0000', '#00BB00', '#FFFF37'],
                            colorByPoint: true,
                            data: [{
                                name: 'Exception',
                                y: parseInt(data.rows[0].CBMpercentage),
                                sliced: true,
                                selected: true
                            }, {
                                name: 'Shipped',
                                y: parseInt(data.rows[1].CBMpercentage)
                            }, {
                                name: 'Open Order',
                                y: parseInt(data.rows[2].CBMpercentage)
                            }]
                        }]
                    });

                    if (rows >= 1) {
                        $('#dgBooking').datagrid('selectRow', 0);

                    }
                }

            });
        });

        function hidet() {
            $("#t").height(10);
        }

        function loadCustomer() {
            $.post("/OnlineBooking_Areas/LoadPlanQuery/GetCustomerList", null, function (data, textStatus) {

                if (textStatus = "success") {

                    $("#Customer").combobox({});
                    $("#Customer").combobox({
                        data: data.Data,
                        valueField: 'cust_name',
                        textField: 'cust_name'
                    });


                } else {

                    alert('get customerlist false');
                }

            })
        }

        function changeTwoDecimal_f(x) {

            var f_x = parseFloat(x);
            //if (isNaN(f_x)) {
            //    alert('function:changeTwoDecimal->parameter error');
            //    return false;
            //}
            var f_x = Math.round(x * 100) / 100;
            var s_x = f_x.toString();
            var pos_decimal = s_x.indexOf('.');
            if (pos_decimal < 0) {
                pos_decimal = s_x.length;
                s_x += '.';
            }
            while (s_x.length <= pos_decimal + 2) {
                s_x += '0';
            }
            return s_x;
        }


        function myformatter(date) {
            var y = date.getFullYear();
            var m = date.getMonth() + 1;
            var d = date.getDate();
            return y + '-' + (m < 10 ? ('0' + m) : m) + '-' + (d < 10 ? ('0' + d) : d);
        }


        /*过滤角色信息*/
        function searchBooking() {
            //将form元素转换为数据对象
            // var aa = xz.serializeObject(searchForm);


            //数组访问方式 jsonData[0].name
            //对象访问方式??aa.startdate

            //datagrid load 方法参数是一个数据对象
            dgBooking.datagrid('load', xz.serializeObject(searchForm));

        }


        function Export() {
            var datagridTitle = "";
            var datagridFields = "";
            var fields = dgBooking.datagrid('getColumnFields');

            var colName = [];
            for (i = 0; i < fields.length; i++) {
                if (fields[i].text == "Choose all") {
                    continue;
                }
                var col = dgBooking.datagrid("getColumnOption", fields[i]);
                if (i == fields.length - 1) {
                    datagridTitle += col.title;
                    datagridFields += fields[i];
                    break;
                }
                datagridTitle += col.title + "+";
                datagridFields += fields[i] + "+";
            }

            $("#Radio_Title").val(datagridTitle);
            $("#Radio_Fields").val(datagridFields);

            //var formParam = {
            //    url: '/Login/LoginIn',
            //    success: dealWithLogin
            //}
            ///*把表单参数对象和表单元素结合起来*/
            //loginInputForm = $('#loginInputForm').form(formParam);

            document.getElementById("searchForm").submit();


        }




        function showPODdownloadView() {
            $.validateUrl('/OnlineBooking_Areas/LoadPlanQuery/PODDownload', showPODdownload, xz.dealWith, 'Get');
        }

        function showPODdownload() {

            var node2 = dgBooking.datagrid('getSelected');
            if (node2) {
                var pAddscan = xz.dialog({
                    title: 'POD Download',
                    width: 400,
                    height: 300,
                    cache: false,
                    queryParams: {
                        //uID: node.b_key, RegID: node.RegDID
                    },
                    iconCls: 'icon-edit',

                    href: '/OnlineBooking_Areas/LoadPlanQuery/PODDownload',
                    buttons: [

                    {
                        text: '关闭',
                        iconCls: 'icon-cancel',
                        handler: function () {
                            // pAddscan.dialog('close');

                            //var fm = pAddscan.find('form');
                            //var pScan_CTN = ff.find("#divScan_CTN").html();

                            //updateSelectedRowScanNumber(node2, pScan_CTN );

                            pAddscan.dialog('destroy');//销毁
                        }

                    }

                    ],
                    onLoad: function () {
                        var ff = pAddscan.find('form');
                        var pdgPod = ff.find("#dgPod");
                        var pConsol = ff.find("#divConsol");
                        var parambarcode = { STO: node2.SalesOrd_STO, Item: node2.ItemNO, Consol: node2.Consol_no };
                        var optionsbarcode = pdgPod.datagrid('options');

                        pConsol.html(node2.Consol_no);
                        optionsbarcode.url = '/OnlineBooking_Areas/LoadPlanQuery/GetTKBooking';
                        optionsbarcode.queryParams = parambarcode;
                        pdgPod.datagrid(optionsbarcode);

                        //var ptxtBarcode = ff.find("#txtBarcode");
                        //ptxtBarcode.focus();
                    },

                    onClose: function () {

                        pAddscan.dialog('destroy');//销毁


                    }

                });
            }

        }

    </script>
    <script>
       
    </script>
</body>
</html>